

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Getting started with the Databricks Labs Data Generator &mdash; Databricks Labs Data Generator 0.11.0-dev1 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/tdg.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="To be added" href="../TOBEADDED.html" />
    <link rel="prev" title="Databricks Labs Data Generator documentation" href="../index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Databricks Labs Data Generator
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Get Started Here</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#general-overview">General Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tutorials-and-examples">Tutorials and examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="#basic-concepts">Basic concepts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#generating-the-test-data">Generating the test data</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#creating-simple-test-data-sets">Creating simple test data sets</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#getting-started">Getting started</a></li>
<li class="toctree-l3"><a class="reference internal" href="#create-a-data-set-without-pre-existing-schemas">Create a data set without pre-existing schemas</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-data-set-with-pre-existing-schema">Creating data set with pre-existing schema</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#adding-dataspecs-to-match-multiple-columns">Adding dataspecs to match multiple columns</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#building-device-iot-test-data">Building Device IOT Test Data</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#using-generated-data-from-sql">Using generated data from SQL</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../TOBEADDED.html">Installation instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="DATARANGES.html">Using data ranges</a></li>
<li class="toctree-l1"><a class="reference internal" href="DISTRIBUTIONS.html">Using data distributions</a></li>
</ul>
<p class="caption"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="quickindex.html">Quick API index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/api/modules.html">The dbldatagen package API</a></li>
</ul>
<p class="caption"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="CONTRIBUTING.html">Contributing to the Databricks Labs Data Generator</a></li>
<li class="toctree-l1"><a class="reference internal" href="CONTRIBUTING.html#building-the-code">Building the code</a></li>
<li class="toctree-l1"><a class="reference internal" href="CONTRIBUTING.html#testing">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="CONTRIBUTING.html#using-the-databricks-labs-data-generator">Using the Databricks Labs data generator</a></li>
<li class="toctree-l1"><a class="reference internal" href="CONTRIBUTING.html#coding-style">Coding Style</a></li>
<li class="toctree-l1"><a class="reference internal" href="CHANGELOG.html">Change log</a></li>
<li class="toctree-l1"><a class="reference internal" href="requirements.html">Build requirements</a></li>
</ul>
<p class="caption"><span class="caption-text">License</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Databricks Labs Data Generator</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Getting started with the Databricks Labs Data Generator</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/relnotes/APIDOCS.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="getting-started-with-the-databricks-labs-data-generator">
<h1>Getting started with the Databricks Labs Data Generator<a class="headerlink" href="#getting-started-with-the-databricks-labs-data-generator" title="Permalink to this headline">¶</a></h1>
<p>The Databricks Labs data generator is a Spark based solution for generating
realistic synthetic data. It uses the features of Spark dataframes and Spark SQL
to generate test data. As the output of the process is a dataframe populated
with test data , it may be saved to storage in a variety of formats, saved to tables
or generally manipulated using the existing Spark Dataframe APIs.</p>
<blockquote>
<div><p>NOTE: This document does not cover all of the classes and methods in the codebase.
For further information on classes and methods contained in  these modules, and
to explore the python documentation for these modules, build the HTML documentation from
the main project directory using <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">docs</span></code>. Use your browser to explore the documentation by
starting with the html file  <code class="docutils literal notranslate"><span class="pre">./python/docs/build/html/index.html</span></code></p>
</div></blockquote>
<div class="section" id="general-overview">
<h2>General Overview<a class="headerlink" href="#general-overview" title="Permalink to this headline">¶</a></h2>
<p>The Databricks Labs Data Generator is a Python Library that can be used in several different ways:</p>
<ol class="simple">
<li><p>Generate a test data set without defining a schema in advance</p></li>
<li><p>Generate a test data set for an existing Spark SQL schema.</p></li>
<li><p>Generate a test data set adding columns according to specifiers provided</p></li>
<li><p>Start with an existing schema and add columns along with specifications as to how values are generated</p></li>
</ol>
<p>The data generator includes the following features:</p>
<ul class="simple">
<li><p>Specify number of rows to generate</p></li>
<li><p>Specify numeric, time and date ranges for columns</p></li>
<li><p>Generate column data at random or from repeatable seed values</p></li>
<li><p>Generate column data from list of finite column values optionally with weighting of how frequently values occur</p></li>
<li><p>Use template based generation and formatting on string columns</p></li>
<li><p>Use SQL based  expression to control or augment column generation</p></li>
<li><p>Script Spark SQL table creation statement for dataset</p></li>
<li><p>Specify a statistical distribution for random values</p></li>
</ul>
</div>
<div class="section" id="tutorials-and-examples">
<h2>Tutorials and examples<a class="headerlink" href="#tutorials-and-examples" title="Permalink to this headline">¶</a></h2>
<p>In the root directory of the project, there are a number of examples and tutorials.</p>
<p>The Python examples in the <code class="docutils literal notranslate"><span class="pre">examples</span></code> folder can be run directly or imported into the Databricks runtime environment as Python files.</p>
<p>The examples in the <code class="docutils literal notranslate"><span class="pre">tutorials</span></code> folder are in notebook export format and are intended to be imported into the Databricks runtime environment.</p>
</div>
<div class="section" id="basic-concepts">
<h2>Basic concepts<a class="headerlink" href="#basic-concepts" title="Permalink to this headline">¶</a></h2>
<p>The Databricks Labs Data Generator is a Python framework that uses Spark to generate a dataframe of test data.</p>
<p>Once the data frame is generated, it can be used with any Spark dataframee compatible API to save or persist data,
to analyze data, to write it to an external database or stream, or generally used in the same manner as a regular dataframe.</p>
<p>To consume it from Scala, R, SQL or other languages, create a view over the resulting test dataframe and you can use
it from any Databricks Spark runtime compatible language. By use of the appropriate parameters,
you can instruct the data generator to automatically register a view as part of generating the test data.</p>
<div class="section" id="generating-the-test-data">
<h3>Generating the test data<a class="headerlink" href="#generating-the-test-data" title="Permalink to this headline">¶</a></h3>
<p>The test data generation process is controlled by a test data generation spec which can build a schema implicitly,
or a schema can be added from an existing table or Spark SQL schema object.</p>
<p>Each column to be generated derives its test data from a set of one or more seed values.
By default, this is the id field of the base data frame
(generated with <code class="docutils literal notranslate"><span class="pre">spark.range</span></code> for batch data frames, or using a <code class="docutils literal notranslate"><span class="pre">Rate</span></code> source for streaming data frames).</p>
<p>Each column  can be specified as based on the <code class="docutils literal notranslate"><span class="pre">id</span></code> field or other columns in the test data generation spec.
Columns may be based on the value of on or more base fields, or on a <code class="docutils literal notranslate"><span class="pre">hash</span></code> of the base values.</p>
<p>Column base values may also be generated at random.</p>
<p>All further data generation on a particular column is controlled by a series of transformations on this base value,
typically one of :</p>
<ul class="simple">
<li><p>Mapping the base value to one of a set of discrete values, optionally with the use of weighting</p></li>
<li><p>Arithmetic transformation of the base value</p></li>
<li><p>Adding string formatting to the base value</p></li>
</ul>
<p>There is also support for applying arbitrary SQL expressions, and generation of common data from templates</p>
</div>
</div>
<div class="section" id="creating-simple-test-data-sets">
<h2>Creating simple test data sets<a class="headerlink" href="#creating-simple-test-data-sets" title="Permalink to this headline">¶</a></h2>
<p>You can use the data generator with, or without the use of a pre-existing schema.</p>
<div class="section" id="getting-started">
<h3>Getting started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h3>
<p>Before you can use the data generator, you need to install the package in your environment and import it in your code.</p>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">dbldatagen</span> <span class="k">as</span> <span class="nn">dg</span>
</pre></div>
</div>
<p>Creating the data set is performed by creating a definition for your dataset via the <code class="docutils literal notranslate"><span class="pre">DataGenerator</span></code> instance, which
specifies the rules that control data generation.</p>
<p>Once the <code class="docutils literal notranslate"><span class="pre">DataGenerator</span></code> specification is created, you use the <code class="docutils literal notranslate"><span class="pre">build</span></code> method to generate a Spark dataframe for the
data</p>
</div>
<div class="section" id="create-a-data-set-without-pre-existing-schemas">
<h3>Create a data set without pre-existing schemas<a class="headerlink" href="#create-a-data-set-without-pre-existing-schemas" title="Permalink to this headline">¶</a></h3>
<p>Here is an example of creating a simple test data set without use of a schema.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">dbldatagen</span> <span class="k">as</span> <span class="nn">dg</span>

<span class="n">row_count</span><span class="o">=</span><span class="mi">1000</span> <span class="o">*</span> <span class="mi">100</span>
<span class="n">testDataSpec</span> <span class="o">=</span> <span class="p">(</span><span class="n">dg</span><span class="o">.</span><span class="n">DataGenerator</span><span class="p">(</span><span class="n">sparkSession</span><span class="o">=</span><span class="n">spark</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;test_data_set1&quot;</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="n">row_count</span><span class="p">,</span>
                                  <span class="n">partitions</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">seed_method</span><span class="o">=</span><span class="s1">&#39;hash_fieldname&#39;</span><span class="p">,</span> 
                                  <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                   <span class="o">.</span><span class="n">withIdOutput</span><span class="p">()</span>
                   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">FloatType</span><span class="p">(),</span> <span class="n">expr</span><span class="o">=</span><span class="s2">&quot;floor(rand() * 350) * (86400 + 3600)&quot;</span><span class="p">,</span>
                                    <span class="n">numColumns</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">column_count</span><span class="p">)</span>
                   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;code1&quot;</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">(),</span> <span class="n">minValue</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">maxValue</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
                   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;code2&quot;</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">(),</span> <span class="n">minValue</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxValue</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">random</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;code3&quot;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;online&#39;</span><span class="p">,</span> <span class="s1">&#39;offline&#39;</span><span class="p">,</span> <span class="s1">&#39;unknown&#39;</span><span class="p">])</span>
                   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;code4&quot;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">],</span> <span class="n">random</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">percent_nulls</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
                   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;code5&quot;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">],</span> <span class="n">random</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
                   <span class="p">)</span>

<span class="n">dfTestData</span> <span class="o">=</span> <span class="n">testDataSpec</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
</pre></div>
</div>
<p>By default, the seed column for each row is the <code class="docutils literal notranslate"><span class="pre">id</span></code> column. Use of the method <code class="docutils literal notranslate"><span class="pre">withIdOutput()</span></code> retains the <code class="docutils literal notranslate"><span class="pre">id</span></code>
field in the output data. If this is not called, the <code class="docutils literal notranslate"><span class="pre">id</span></code> field is used during data generation, but it is dropped
from the final data output.</p>
<p>Each of the <code class="docutils literal notranslate"><span class="pre">withColumn</span></code> method calls introduces a new column (or columns).</p>
<p>The example above shows some common uses:</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">withColumn</span></code> method call for the <code class="docutils literal notranslate"><span class="pre">r</span></code> column introduces multiple columns labelled <code class="docutils literal notranslate"><span class="pre">r1</span></code> to <code class="docutils literal notranslate"><span class="pre">rN</span></code> as determined by
the <code class="docutils literal notranslate"><span class="pre">numColumns</span></code> option. Here, we use the <code class="docutils literal notranslate"><span class="pre">expr</span></code> option to introduce a SQL expression to control the generation of the
column. Note this expression can refer to any preceding column including the <code class="docutils literal notranslate"><span class="pre">id</span></code> column.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">withColumn</span></code> method call for the <code class="docutils literal notranslate"><span class="pre">code1</span></code> column specifies the generation of values between 100 and 200
inclusive. These will be computed using modulo arithmetic on the <code class="docutils literal notranslate"><span class="pre">id</span></code> column.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">withColumn</span></code> method call for the <code class="docutils literal notranslate"><span class="pre">code2</span></code> column specifies the generation of values between 0 and 10
inclusive. These will be computed via a uniformly distributed random value.</p></li>
</ul>
<blockquote>
<div><p>By default all random values are uniformly distributed
unless either the <code class="docutils literal notranslate"><span class="pre">weights</span></code> option is used or a specific distribution is used.</p>
</div></blockquote>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">withColumn</span></code> method call for the <code class="docutils literal notranslate"><span class="pre">code3</span></code> column specifies the generation of string values from
the allowable values <code class="docutils literal notranslate"><span class="pre">['online',</span> <span class="pre">'offline',</span> <span class="pre">or</span> <span class="pre">'unknown']</span></code>
inclusive. These will be computed using modulo arithmetic on the <code class="docutils literal notranslate"><span class="pre">id</span></code> column and the resulting value mapped to the
set of allowable values</p></li>
</ul>
<blockquote>
<div><p>Specific value lists can be used with any data type fields - but user is responsible for ensuring the values are of
a compatible data type.</p>
</div></blockquote>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">withColumn</span></code> method call for the <code class="docutils literal notranslate"><span class="pre">code4</span></code> column specifies the generation of string values from
the allowable values <code class="docutils literal notranslate"><span class="pre">['a',</span> <span class="pre">'b',</span> <span class="pre">or</span> <span class="pre">'c']</span></code>
inclusive. But the <code class="docutils literal notranslate"><span class="pre">percent_nulls</span></code> option gives a 5% chance of a null value being generated.
These will be computed via a uniformly distributed random value.</p></li>
</ul>
<blockquote>
<div><p>By default null values will not be generated for a field, unless the <code class="docutils literal notranslate"><span class="pre">percent_nulls</span></code> option is specified</p>
</div></blockquote>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">withColumn</span></code> method call for the <code class="docutils literal notranslate"><span class="pre">code5</span></code> column specifies the generation of string values from
the allowable values <code class="docutils literal notranslate"><span class="pre">['a',</span> <span class="pre">'b',</span> <span class="pre">or</span> <span class="pre">'c']</span></code>
inclusive. These will be computed via a uniformly distributed random value but with weighting applied so that
the value <code class="docutils literal notranslate"><span class="pre">a</span></code> occurs 9 times as frequently as the values <code class="docutils literal notranslate"><span class="pre">b</span></code> or <code class="docutils literal notranslate"><span class="pre">c</span></code></p></li>
</ul>
</div>
<div class="section" id="creating-data-set-with-pre-existing-schema">
<h3>Creating data set with pre-existing schema<a class="headerlink" href="#creating-data-set-with-pre-existing-schema" title="Permalink to this headline">¶</a></h3>
<p>What if we want to generate data conforming to a pre-existing schema? you can specify a schema for your data by either
taking a schema from an existing table, or computing an explicit schema.</p>
<p>In this case you would use the <code class="docutils literal notranslate"><span class="pre">withColumnSpec</span></code> method instead of the <code class="docutils literal notranslate"><span class="pre">withColumn</span></code> method.</p>
<p>For fields imported from the schema, the schema controls the field name and data type, but the column specification
controls how the data is generated.</p>
<div class="section" id="adding-dataspecs-to-match-multiple-columns">
<h4>Adding dataspecs to match multiple columns<a class="headerlink" href="#adding-dataspecs-to-match-multiple-columns" title="Permalink to this headline">¶</a></h4>
<p>For large schemas, it can be unwieldy to specify column generation specs for every column in a schema.</p>
<p>To alleviate this , the framework provides mechanisms to add rules in bulk for multiple columns.</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">withColumnSpecs</span></code> method introduces a column generation specification for all columns matching a specific
naming pattern or datatype. You can override the column specification for a specific column using
the <code class="docutils literal notranslate"><span class="pre">withColumnSpec</span></code> method.</p></li>
</ul>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="p">(</span><span class="n">dg</span>
       <span class="o">.</span><span class="n">withColumnSpecs</span><span class="p">(</span><span class="n">patterns</span><span class="o">=</span><span class="s2">&quot;.*_ID&quot;</span><span class="p">,</span> <span class="n">match_types</span><span class="o">=</span><span class="n">StringType</span><span class="p">(),</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%010d</span><span class="s2">&quot;</span><span class="p">,</span> 
                               <span class="n">minValue</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">maxValue</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
       <span class="o">.</span><span class="n">withColumnSpecs</span><span class="p">(</span><span class="n">patterns</span><span class="o">=</span><span class="s2">&quot;.*_IDS&quot;</span><span class="p">,</span> <span class="n">match_types</span><span class="o">=</span><span class="n">StringType</span><span class="p">(),</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%010d</span><span class="s2">&quot;</span><span class="p">,</span> 
                               <span class="n">minValue</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">maxValue</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="building-device-iot-test-data">
<h3>Building Device IOT Test Data<a class="headerlink" href="#building-device-iot-test-data" title="Permalink to this headline">¶</a></h3>
<p>This example shows generation of IOT device style data consisting of events from devices.</p>
<p>Here we want to generate a random set of events but ensure that the device properties remain the same for the
device from event to event.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">dbldatagen</span> <span class="k">as</span> <span class="nn">dg</span>
<span class="kn">from</span> <span class="nn">pyspark.sql.types</span> <span class="kn">import</span> <span class="n">StructType</span><span class="p">,</span> <span class="n">StructField</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">,</span> <span class="n">StringType</span><span class="p">,</span> <span class="n">FloatType</span><span class="p">,</span> <span class="n">TimestampType</span><span class="p">,</span> <span class="n">DateType</span><span class="p">,</span> <span class="n">LongType</span>
<span class="kn">from</span> <span class="nn">dbldatagen</span> <span class="kn">import</span> <span class="n">DateRange</span><span class="p">,</span> <span class="n">NRange</span>

<span class="n">shuffle_partitions_requested</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">device_population</span> <span class="o">=</span> <span class="mi">100000</span>
<span class="n">data_rows</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="mi">1000000</span>

<span class="n">spark</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;spark.sql.shuffle.partitions&quot;</span><span class="p">,</span> <span class="n">shuffle_partitions_requested</span><span class="p">)</span>

<span class="n">country_codes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;CN&#39;</span><span class="p">,</span> <span class="s1">&#39;US&#39;</span><span class="p">,</span> <span class="s1">&#39;FR&#39;</span><span class="p">,</span> <span class="s1">&#39;CA&#39;</span><span class="p">,</span> <span class="s1">&#39;IN&#39;</span><span class="p">,</span> <span class="s1">&#39;JM&#39;</span><span class="p">,</span> <span class="s1">&#39;IE&#39;</span><span class="p">,</span> <span class="s1">&#39;PK&#39;</span><span class="p">,</span><span class="s1">&#39;GB&#39;</span><span class="p">,</span><span class="s1">&#39;IL&#39;</span><span class="p">,</span>  <span class="s1">&#39;AU&#39;</span><span class="p">,</span> <span class="s1">&#39;SG&#39;</span><span class="p">,</span> <span class="s1">&#39;ES&#39;</span><span class="p">,</span> <span class="s1">&#39;GE&#39;</span><span class="p">,</span> <span class="s1">&#39;MX&#39;</span><span class="p">,</span> <span class="s1">&#39;ET&#39;</span><span class="p">,</span> <span class="s1">&#39;SA&#39;</span><span class="p">,</span> <span class="s1">&#39;LB&#39;</span><span class="p">,</span> <span class="s1">&#39;NL&#39;</span> <span class="p">]</span>
<span class="n">country_weights</span><span class="o">=</span><span class="p">[</span><span class="mi">1300</span><span class="p">,</span> <span class="mi">365</span><span class="p">,</span> <span class="mi">67</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span> <span class="mi">1300</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">212</span><span class="p">,</span><span class="mi">67</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span>  <span class="mi">25</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">47</span><span class="p">,</span> <span class="mi">83</span><span class="p">,</span> <span class="mi">126</span><span class="p">,</span> <span class="mi">109</span><span class="p">,</span> <span class="mi">58</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">17</span> <span class="p">]</span>

<span class="n">manufacturers</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;Delta corp&#39;</span><span class="p">,</span> <span class="s1">&#39;Xyzzy Inc.&#39;</span><span class="p">,</span> <span class="s1">&#39;Lakehouse Ltd&#39;</span><span class="p">,</span> <span class="s1">&#39;Acme Corp&#39;</span><span class="p">,</span> <span class="s1">&#39;Embanks Devices&#39;</span><span class="p">]</span>

<span class="n">lines</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;delta&#39;</span><span class="p">,</span> <span class="s1">&#39;xyzzy&#39;</span><span class="p">,</span> <span class="s1">&#39;lakehouse&#39;</span><span class="p">,</span> <span class="s1">&#39;gadget&#39;</span><span class="p">,</span> <span class="s1">&#39;droid&#39;</span><span class="p">]</span>


<span class="n">testDataSpec</span> <span class="o">=</span> <span class="p">(</span><span class="n">dg</span><span class="o">.</span><span class="n">DataGenerator</span><span class="p">(</span><span class="n">sparkSession</span><span class="o">=</span><span class="n">spark</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;device_data_set&quot;</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="n">data_rows</span><span class="p">,</span>
                                             <span class="n">partitions</span><span class="o">=</span><span class="n">partitions_requested</span><span class="p">,</span> <span class="n">seed_method</span><span class="o">=</span><span class="s1">&#39;hash_fieldname&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="o">.</span><span class="n">withIdOutput</span><span class="p">()</span>
    <span class="c1"># we&#39;ll use hash of the base field to generate the ids to avoid a simple incrementing sequence</span>
    <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;internal_device_id&quot;</span><span class="p">,</span> <span class="n">LongType</span><span class="p">(),</span> <span class="n">minValue</span><span class="o">=</span><span class="mh">0x1000000000000</span><span class="p">,</span> <span class="n">unique_values</span><span class="o">=</span><span class="n">device_population</span><span class="p">)</span>

    <span class="c1"># note for format strings, we must use &quot;%lx&quot; not &quot;%x&quot; as the underlying value is a long</span>
    <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;device_id&quot;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;0x</span><span class="si">%013x</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">base_column</span><span class="o">=</span><span class="s2">&quot;internal_device_id&quot;</span><span class="p">)</span>
    <span class="c1">#.withColumn(&quot;device_id_2&quot;, StringType(), format=&#39;0x%013x&#39;, base_column=&quot;internal_device_id&quot;)</span>

    <span class="c1"># the device / user attributes will be the same for the same device id - so lets use the internal device id as the base column for these attribute</span>
    <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;country&quot;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="n">values</span><span class="o">=</span><span class="n">country_codes</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">country_weights</span><span class="p">,</span>
          <span class="n">base_column</span><span class="o">=</span><span class="s2">&quot;internal_device_id&quot;</span><span class="p">,</span> <span class="n">base_column_type</span><span class="o">=</span><span class="s2">&quot;hash&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;country2a&quot;</span><span class="p">,</span> <span class="n">LongType</span><span class="p">(),</span> <span class="n">expr</span><span class="o">=</span><span class="s2">&quot;((hash(internal_device_id) % 3847) + 3847) % 3847&quot;</span><span class="p">,</span> 
          <span class="n">base_column</span><span class="o">=</span><span class="s2">&quot;internal_device_id&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;country2&quot;</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">(),</span> <span class="n">expr</span><span class="o">=</span><span class="s2">&quot;floor(cast( (((internal_device_id % 3847) + 3847) % 3847) as double) )&quot;</span><span class="p">,</span> 
          <span class="n">base_column</span><span class="o">=</span><span class="s2">&quot;internal_device_id&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;country3&quot;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="n">values</span><span class="o">=</span><span class="n">country_codes</span><span class="p">,</span> <span class="n">base_column</span><span class="o">=</span><span class="s2">&quot;country2&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;manufacturer&quot;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="n">values</span><span class="o">=</span><span class="n">manufacturers</span><span class="p">,</span> <span class="n">base_column</span><span class="o">=</span><span class="s2">&quot;internal_device_id&quot;</span><span class="p">)</span>

    <span class="c1"># use omit = True if you dont want a column to appear in the final output but just want to use it as part of generation of another column</span>
    <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;line&quot;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="n">values</span><span class="o">=</span><span class="n">lines</span><span class="p">,</span> <span class="n">base_column</span><span class="o">=</span><span class="s2">&quot;manufacturer&quot;</span><span class="p">,</span> 
           <span class="n">base_column_type</span><span class="o">=</span><span class="s2">&quot;hash&quot;</span><span class="p">,</span> <span class="n">omit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;model_ser&quot;</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">(),</span> <span class="n">minValue</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">maxValue</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span>  <span class="n">base_column</span><span class="o">=</span><span class="s2">&quot;device_id&quot;</span><span class="p">,</span> <span class="n">base_column_type</span><span class="o">=</span><span class="s2">&quot;hash&quot;</span><span class="p">,</span> <span class="n">omit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;model_line&quot;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="n">expr</span><span class="o">=</span><span class="s2">&quot;concat(line, &#39;#&#39;, model_ser)&quot;</span><span class="p">,</span> <span class="n">base_column</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;line&quot;</span><span class="p">,</span> <span class="s2">&quot;model_ser&quot;</span><span class="p">])</span>
    <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;event_type&quot;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">(),</span> <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;activation&quot;</span><span class="p">,</span> <span class="s2">&quot;deactivation&quot;</span><span class="p">,</span> <span class="s2">&quot;plan change&quot;</span><span class="p">,</span> <span class="s2">&quot;telecoms activity&quot;</span><span class="p">,</span> <span class="s2">&quot;internet activity&quot;</span><span class="p">,</span> <span class="s2">&quot;device error&quot;</span><span class="p">],</span> <span class="n">random</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="p">)</span>

<span class="n">dfTestData</span> <span class="o">=</span> <span class="n">testDataSpec</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>

<span class="n">dfTestData</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>

<span class="n">display</span><span class="p">(</span><span class="n">dfTestData</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">withColumn</span></code> method call for the <code class="docutils literal notranslate"><span class="pre">internalDeviceId</span></code> column uses the <code class="docutils literal notranslate"><span class="pre">uniqueValues</span></code> option to control the number
of unique values.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">withColumn</span></code> method call for the <code class="docutils literal notranslate"><span class="pre">manufacture</span></code> column uses the <code class="docutils literal notranslate"><span class="pre">base_column</span></code> option to ensure we get the same
manufacturer value for each <code class="docutils literal notranslate"><span class="pre">internalDeviceId</span></code>. This allows us to generate IOT style events at random, but still
constrain properties whenever the same <code class="docutils literal notranslate"><span class="pre">internalDeviceId</span></code> occurs.<br />of unique values.</p></li>
</ul>
<blockquote>
<div><p>A column may be based on one or more other columns. This means the value of that column will be used as a seed for
generating the new column. The <code class="docutils literal notranslate"><span class="pre">base_column_type</span></code> option determines if the actual value , or hash of the value is
used as the seed value.</p>
</div></blockquote>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">withColumn</span></code> method call for the <code class="docutils literal notranslate"><span class="pre">line</span></code> column introduces a temporary column for purposes of
generating other columns, but through the use of the <code class="docutils literal notranslate"><span class="pre">omit</span></code> option, omits it from the final data set.</p></li>
</ul>
</div>
</div>
<div class="section" id="using-generated-data-from-sql">
<h2>Using generated data from SQL<a class="headerlink" href="#using-generated-data-from-sql" title="Permalink to this headline">¶</a></h2>
<p>By defining a view over the generated data, you can use the generated data from SQL.</p>
<p>To simply this process, you can use options to generate temporary or global views over the data.</p>
<p>At the time of writing, the specification for generation of data needs to be authored in Python.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../TOBEADDED.html" class="btn btn-neutral float-right" title="To be added" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="../index.html" class="btn btn-neutral float-left" title="Databricks Labs Data Generator documentation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020, Databricks Inc.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>